<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<button onclick="addNewCustomer(listCustomer)">Them Khach Hang Moi</button>
<p id="scr"></p>
<script>
    class Customer {
        constructor(name, cmnd, birthday, email, address, typeCustomer, typeRoom, typeService, rentDays, quantityIncluded, discount) {
            this.name = name;
            this.cmnd = cmnd;
            this.birthday = birthday;
            this.email = email;
            this.address = address;
            this.typeCustomer = typeCustomer;
            this.typeRoom = typeRoom;
            this.typeService = typeService;
            this.rentDays = rentDays;
            this.quantityIncluded = quantityIncluded;
            this.discount = discount;
        }

        getName() {
            return this.name;
        }

        getCMND() {
            return this.cmnd;
        }

        getBirthday() {
            return this.birthday;
        }

        getEmail() {
            return this.email;
        }

        getAddress() {
            return this.address;
        }

        getTypeCustomer() {
            return this.typeCustomer;
        }

        getDiscount() {
            return this.discount;
        }

        getTypeRoom() {
            return this.typeRoom;
        }

        getTypeService() {
            return this.typeService;
        }

        getRentDays() {
            return this.rentDays;
        }

        getQuantityIncluded() {
            return this.quantityIncluded;
        }

        setName(name) {
            this.name = name;
        }

        setCMND(cmnd) {
            this.cmnd = cmnd;
        }

        setBirthday(birthday) {
            this.birthday = birthday;
        }

        setEmail(email) {
            this.email = email;
        }

        setAddress(address) {
            this.address = address;
        }

        setTypeCustomer(type) {
            this.typeCustomer = type;
        }

        setDiscount(discount) {
            this.discount = discount;
        }

        setTypeRoom(type) {
            this.typeRoom = type;
        }

        setTypeService(type) {
            this.typeService = type;
        }

        setRentDays(rentDays) {
            this.rentDays = rentDays;
        }

        setQuantityIncluded(quantity) {
            this.quantityIncluded = quantity;
        }

        totalPay() {
            let totalPay;
            switch (this.typeService) {
                case "villa":
                    totalPay = 500 * parseInt(this.rentDays) * (1 - this.discount / parseFloat(100));
                    break;
                case "house":
                    totalPay = 300 * parseInt(this.rentDays) * (1 - this.discount / parseFloat(100));
                    break;
                case  "room":
                    totalPay = 100 * parseInt(this.rentDays) * (1 - this.discount / parseFloat(100));
                    break;
            }
            return totalPay;
        }
        getInfo() {
            return "1. Ho va Ten: " + this.name + "\n2. CMND: " + this.cmnd +
                "\n3. Ngay sinh: " + this.birthday + "\n 4. Email: " + this.email+
                "\n5. Dia chi: "+this.address+"\n6. Loai khach hang: "+this.getTypeCustomer()+
                "\n7. Loai phong: "+this.typeRoom+"\n8. Loai dich vu: "+this.typeService+
                "\n9. So ngay thue: "+this.rentDays+"\n10. So luong di kem: "+this.quantityIncluded+
                "\n11. Giam gia: "+this.discount;
        }

    }

    function editCustomer(i) {
            let choose= prompt(listCustomer[i].getInfo()+
                '\n12. Thoát');
            switch (parseInt(choose)) {
                case 1:
                    let name = prompt("Nhap ten");
                    let name2 = "";
                    name = name.trim();
                    name = name.toLowerCase();
                    for (let i = 0; i < name.length; i++) {
                        if ((name.charAt(i) == " ") && (name.charAt(i + 1) == " ")) {
                            continue;
                        } else if ((i == 0) || (name.charAt(i - 1) == " ")) {
                            name2 += name.charAt(i).toUpperCase();
                        } else {
                            name2 += name.charAt(i);
                        }
                    }
                    name = name2;
                    listCustomer[i].setName(name);
                    editCustomer(i);
                    break;
                case 2:
                    let cmnd;
                    do {
                        cmnd = prompt("So CMND");
                        check = true;
                        if ((cmnd == "") || (isNaN(cmnd)) || (parseInt(cmnd) < 0) || (cmnd.length != 9)) {
                            continue;
                        }
                        check = !Number.isInteger(cmnd * 1);
                    } while (check);
                    listCustomer[i].setCMND(cmnd);
                    editCustomer(i);
                    break;
                case 3:
                    let birthday;
                    do {
                        birthday = prompt("Nhap ngay sinh");
                    } while (!checkBirthday(birthday));
                    listCustomer[i].setBirthday(birthday);
                    editCustomer(i);
                    break;
                case 4:
                    let email;
                    do {
                        email = prompt("Nhap Email")
                    } while (!checkEmail(email));
                    listCustomer[i].setEmail(email);
                    editCustomer(i);
                    break;
                case 5:
                    let address = prompt("Nhap dia chi");
                    listCustomer[i].setAddress(address);
                    editCustomer(i);
                    break;
                case 6:
                    let typeCustomer = prompt("Nhap loai khach hang");
                    listCustomer[i].setTypeCustomer(typeCustomer);
                    editCustomer(i);
                    break;
                case 7:
                    let typeRoom = prompt("Nhap loai phong");
                    listCustomer[i].setTypeRoom(typeRoom);
                    editCustomer(i);
                    break;
                case 8:
                    let typeService = prompt("Nhap loai dich vu");
                    listCustomer[i].setTypeService(typeService);
                    editCustomer(i);
                    break;
                case 9:
                    let rentDays = prompt("Nhap so ngay thue");
                    listCustomer[i].setRentDays(rentDays);
                    editCustomer(i);
                    break;
                case 10:
                    let quantityIncluded = prompt("Nhap so luong di kem");
                    listCustomer[i].setQuantityIncluded(quantityIncluded);
                    editCustomer(i);
                    break;
                case 11:
                    let discount = prompt("Nhap giam gia");
                    listCustomer[i].setDiscount(discount);
                    editCustomer(i);
                    break;
                    case 12:
                        break;
                default:
                    alert("Lua chon cua ban khong nam trong trinh don");
                    editCustomer(i);
            }
        displayCustomer(listCustomer);
        }

    function deleteCustomer(id) {
        let xacNhanXoa = confirm("bạn có muốn xóa khach hang: "+ listCustomer[id].getName());
        if (xacNhanXoa){
            listCustomer.splice(id,1);
        }else {
            alert("bạn không muốn xóa");
        }
        displayCustomer(listCustomer);
    }
    function addNewCustomer(arr) {
        let name = prompt("Nhap ten");
        let name2 = "";
        name = name.trim();
        name = name.toLowerCase();
        for (let i = 0; i < name.length; i++) {
            if ((name.charAt(i) == " ") && (name.charAt(i + 1) == " ")) {
                continue;
            } else if ((i == 0) || (name.charAt(i - 1) == " ")) {
                name2 += name.charAt(i).toUpperCase();
            } else {
                name2 += name.charAt(i);
            }
        }
        name = name2;
        let cmnd;
        do {
            cmnd = prompt("So CMND");
            check = true;
            if ((cmnd == "") || (isNaN(cmnd)) || (parseInt(cmnd) < 0) || (cmnd.length != 9)) {
                continue;
            }
            check = !Number.isInteger(cmnd * 1);
        } while (check);
        let birthday;
        do {
            birthday = prompt("Nhap ngay sinh");
        } while (!checkBirthday(birthday));

        let email;
        do {
            email = prompt("Nhap Email")
        } while (!checkEmail(email));
        let address = prompt("Nhap dia chi");
        let typeCustomer = prompt("Nhap loai khach hang");
        let discount = prompt("Nhap giam gia");
        let typeRoom = prompt("Nhap loai phong");
        let typeService = prompt("Nhap loai dich vu");
        let rentDays = prompt("Nhap so ngay thue");
        let quantityIncluded = prompt("Nhap so luong di kem");
        let newCustomer = new Customer(name, cmnd, birthday, email, address, typeCustomer, typeRoom, typeService, rentDays, quantityIncluded, discount);
        arr.push(newCustomer);
        displayCustomer(arr);
    }

    function checkEmail(email) {
        const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }

    function checkBirthday(birthday) {
        const reg = /^(((0[1-9]|[12]\d|3[01])\/(0[13578]|1[02])\/((19|[2-9]\d)\d{2}))|((0[1-9]|[12]\d|30)\/(0[13456789]|1[012])\/((19|[2-9]\d)\d{2}))|((0[1-9]|1\d|2[0-8])\/02\/((19|[2-9]\d)\d{2}))|(29\/02\/((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|(([1][26]|[2468][048]|[3579][26])00))))$/g;
        return reg.test(birthday);
    }

    function displayCustomer(arr) {
        let bang = "<table border='1'>\n" +
            "    <tr>\n" +
            "        <th>Ho va ten</th>\n" +
            "        <th>CMND</th>\n" +
            "        <th>Ngay sinh</th>\n" +
            "        <th>Email</th>\n" +
            "        <th>Dia chi</th>\n" +
            "        <th>Loai Khach Hang</th>\n" +
            "        <th>Loai phong</th>\n" +
            "        <th>Loai dich vu</th>\n" +
            "        <th>So ngay thue</th>\n" +
            "        <th>So luong di kem</th>\n" +
            "        <th>Giam gia</th>\n" +
            "        <th>Tong tien phai tra</th>\n" +
            "    </tr>";
        for (let i = 0; i < arr.length; i++) {
            bang += " <tr>\n" +
                "        <td>" + arr[i].getName() + "</td>\n" +
                "        <td>" + arr[i].getCMND() + "</td>\n" +
                "        <td>" + arr[i].getBirthday() + "</td>\n" +
                "        <td>" + arr[i].getEmail() + "</td>\n" +
                "        <td>" + arr[i].getAddress() + "</td>\n" +
                "        <td>" + arr[i].getTypeCustomer() + "</td>\n" +
                "        <td>" + arr[i].getTypeRoom() + "</td>\n" +
                "        <td>" + arr[i].getTypeService() + "</td>\n" +
                "        <td>" + arr[i].getRentDays() + "</td>\n" +
                "        <td>" + arr[i].getQuantityIncluded() + "</td>\n" +
                "        <td>" + arr[i].getDiscount() + "</td>\n" +
                "        <td>" + arr[i].totalPay() + "</td>\n" +
                "        <td><button onclick=\"editCustomer(" + i + ")\">Sua</button></td>\n" +
                "        <td><button onclick=\"deleteCustomer(" + i + ")\">Xoa</button></td>\n" +
                "    </tr>";
        }
        bang += "</table>";
        document.getElementById("scr").innerHTML = bang;
    }
    let listCustomer=[];
    let customer1=new Customer("Nguyen Van A",112345678,"12/12/2000","dsds@sdas.com","Da nang","gold","vip","villa",6,5,20);
    listCustomer.push(customer1);
    displayCustomer(listCustomer);
</script>
</body>
</html>